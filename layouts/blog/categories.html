{{ define "main" }}
<div class="container">
    <header class="page-header">
        <h1>Categories</h1>
        <p class="page-description">All categories used on this blog</p>
    </header>
    
    {{ $blogPages := where .Site.RegularPages "Section" "blog" }}
    {{ $categories := slice }}
    {{ range $blogPages }}
        {{ range .Params.categories }}
            {{ $categories = $categories | append . }}
        {{ end }}
    {{ end }}
    
    {{ $uniqueCategories := $categories | uniq }}
    {{ if $uniqueCategories }}
    <div class="terms-list">
        {{ range $uniqueCategories }}
        {{ $category := . }}
        {{ $categoryPosts := where $blogPages ".Params.categories" "intersect" (slice $category) }}
        <div class="term-item">
            <h3 class="term-name">
                <a href="{{ printf "/blog/categories/%s/" (. | urlize) | relURL }}">{{ . }}</a>
            </h3>
            <p class="term-count">{{ len $categoryPosts }} {{ if eq (len $categoryPosts) 1 }}post{{ else }}posts{{ end }}</p>
        </div>
        {{ end }}
    </div>
    {{ else }}
    <p class="no-terms">No categories found.</p>
    {{ end }}
</div>
{{ end }}
